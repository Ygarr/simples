
/**
 * Trivial keystore.  This hard-coded keystore contains a self-signed
 * certificate, for not.very.secure.com.  See ../ssl for the code that
 * generates it.  This is enough to make SSL work, if you don't mind
 * adding a security exception to your browser.  That's good enough, if
 * you goal is just so someone with a wifi snooper can't see your
 * traffic in the clear.
 */
import java.io.ByteArrayInputStream
import java.security.SecureRandom
import java.security.KeyStore
import java.security.Security
import javax.net.ssl.KeyManagerFactory
import javax.net.ssl.SSLContext

fun setupSslKeystore() {
    // self-signed keystore auto-generated Tue Aug  9 20:55:23 PDT 2016
    // 
    // See ../ssl/run.sh
    //
    val keystore = byteArrayOf(
            -2, -19, -2, -19, 0, 0, 0, 2, 
            0, 0, 0, 1, 0, 0, 0, 1, 
            0, 4, 115, 101, 108, 102, 0, 0, 
            1, 86, 114, -105, 29, -72, 0, 0, 
            5, 3, 48, -126, 4, -1, 48, 14, 
            6, 10, 43, 6, 1, 4, 1, 42, 
            2, 17, 1, 1, 5, 0, 4, -126, 
            4, -21, 56, -89, 126, 38, -50, -70, 
            114, 40, -52, -70, -121, 22, 43, 49, 
            36, -52, -58, 118, 44, -60, 117, 99, 
            113, 44, 112, 105, 6, -42, 2, 116, 
            -14, -123, 79, 12, -33, 5, 106, -13, 
            55, 57, 98, 28, 39, -32, 59, -59, 
            -123, 91, -11, -126, -102, 125, 61, -71, 
            -99, -73, 86, -91, -64, -80, 118, -107, 
            99, 54, -59, -112, -106, 59, -67, -18, 
            22, -96, 88, -103, 14, 124, 99, 45, 
            35, -114, -60, -80, 79, 126, -82, -109, 
            41, -47, 122, 98, -9, 3, -3, -62, 
            56, 67, -89, 99, 54, -71, 84, -21, 
            -32, 37, 51, -44, -92, -80, 116, 85, 
            -118, 58, -63, -82, -21, 40, 16, 60, 
            107, -28, -122, -88, 74, 39, 89, 127, 
            74, -89, 81, -54, 73, 71, -86, 43, 
            -17, -78, 95, -122, -35, 94, 16, 28, 
            -102, -26, -54, 83, 49, 93, 125, 68, 
            100, 77, -13, 94, -67, 5, 59, 96, 
            23, 38, -37, -70, 35, -20, 16, -42, 
            121, 21, -5, -119, 95, -99, -64, -62, 
            -14, -54, 114, 39, -86, -118, 80, 101, 
            -89, -54, -2, -57, 70, -101, 111, 38, 
            -48, -105, 92, -23, 121, -119, 98, -126, 
            73, 52, -79, -49, 22, -101, -14, -11, 
            39, 34, 61, 60, 80, 57, -114, 64, 
            -105, -103, 92, -32, -97, 6, -53, -85, 
            -119, 38, 60, 103, -108, 80, 41, 79, 
            -105, 78, 51, 34, -49, -10, -49, 43, 
            57, 12, -128, -22, 101, 91, 59, -53, 
            -88, 33, -30, 110, 41, 39, 2, 110, 
            21, 106, 14, -56, 75, 83, 118, -19, 
            -68, 0, -116, -65, 107, 13, 116, 58, 
            6, 34, 108, -111, 52, -69, 47, -73, 
            -27, 64, -100, 28, -14, 66, 117, -3, 
            59, -28, -103, 2, -39, 106, -35, -53, 
            123, 59, -13, 56, 92, 103, 79, 114, 
            6, -61, -62, 16, -9, 61, 3, 83, 
            -7, 73, 126, -101, 60, 64, 47, -107, 
            127, -60, -63, 39, -99, -89, 112, -76, 
            76, 42, -123, -33, -80, 35, -5, 7, 
            28, 62, 51, 72, 51, 100, -10, -44, 
            82, -105, -110, -125, -115, -100, -122, 92, 
            96, 29, -106, 91, -13, 51, -118, 23, 
            -4, 74, 46, 50, 10, 76, -25, -79, 
            89, 123, -25, -35, 102, 50, -60, -123, 
            10, 12, -39, -110, 88, 124, 28, -98, 
            108, 47, 80, -72, -120, -52, 13, -27, 
            -96, 5, -109, -84, 21, 124, -74, 38, 
            103, -89, -51, 125, -47, 107, -4, 105, 
            -110, -31, -46, 39, 65, -32, -118, -123, 
            -18, -87, -78, 77, 31, -25, 73, -123, 
            41, -124, 90, -36, -14, 102, -82, -55, 
            9, 17, 28, 43, -56, 11, -7, -28, 
            -84, -101, 19, 72, 97, -63, 55, 112, 
            -110, 3, 115, 80, 76, 104, 30, 29, 
            -23, -114, -93, 36, 63, 41, -108, 76, 
            80, 29, 57, -26, -90, -3, -77, 120, 
            45, 21, 66, 16, 64, 4, -128, 34, 
            -18, 118, 49, -128, -48, -28, 53, -100, 
            99, 74, -17, 94, 45, 103, -6, 49, 
            -64, 76, -2, 15, 55, 79, 24, -7, 
            28, -43, -4, 108, 6, -91, 123, 34, 
            31, -81, -37, -56, -111, -63, 89, 92, 
            117, -3, 20, -75, 91, 63, -57, 124, 
            -125, -23, 17, -8, 8, 54, 112, 79, 
            -27, 3, -18, 88, 91, 18, -70, 53, 
            -51, 21, 120, 39, -106, 26, 106, -7, 
            -37, -6, -76, -20, 55, -46, -85, 8, 
            51, -81, -20, -9, -40, -127, -72, 3, 
            57, -3, 100, -47, -80, 16, -40, -44, 
            -110, 110, 44, 94, 23, -47, -39, 82, 
            103, 75, 126, 126, -33, -4, 30, 28, 
            -34, 56, 125, -31, -85, -73, 44, -85, 
            68, -95, -27, -119, -103, -102, 44, -124, 
            -36, 10, 58, -110, 87, 88, -19, 55, 
            -103, -71, -35, 102, 119, 83, 124, -19, 
            -63, -41, 78, 60, -6, -9, -6, -89, 
            109, -101, -20, 34, -33, 72, -2, 31, 
            80, 10, -110, -123, -16, -72, -38, 82, 
            111, -118, 87, -19, -95, 44, -22, -53, 
            -88, 4, -96, 102, -25, 5, 111, 73, 
            16, 115, -95, 114, 116, 123, 78, -59, 
            121, -53, 46, 52, 62, 26, 11, -101, 
            127, -79, 22, 88, -124, -13, -121, -3, 
            40, -99, -122, 98, -57, -53, 44, -79, 
            10, 78, 50, 33, 120, 30, -108, 2, 
            -21, 118, 33, 25, -71, -8, 107, 78, 
            77, 76, 76, 118, -113, -46, -110, 48, 
            14, 43, -64, -120, 5, -67, 89, -85, 
            -104, -40, 120, 43, -38, 124, -100, -121, 
            16, 79, -44, -100, -39, -95, -70, -103, 
            4, -35, 22, -14, 3, 69, -115, 121, 
            124, 49, 46, -75, 19, 26, 11, 4, 
            117, 75, -33, -80, -102, -79, -17, -98, 
            -13, 71, 106, 47, 82, 95, 4, 82, 
            46, -89, 70, 124, 39, 94, 93, -22, 
            -107, 118, 80, 109, -24, -59, -125, 92, 
            -84, 114, 18, 32, -64, 96, -118, 63, 
            58, 6, -77, 41, 18, -36, -46, 92, 
            118, 55, 123, 49, -78, 96, 92, -49, 
            -112, 88, 29, 70, -26, 127, -75, 86, 
            75, 90, -39, 54, 28, -36, -83, -58, 
            119, -83, -77, -99, 120, -31, 31, -19, 
            76, -27, -92, 101, 24, 37, -17, 70, 
            -65, 111, -61, -106, -22, -36, 77, -94, 
            -84, 74, -25, -65, 38, -95, -25, -88, 
            24, -97, 126, 118, -88, 9, 99, -114, 
            -13, -90, -95, 40, -51, -36, -6, -38, 
            -20, 30, 80, 64, -101, 74, 31, 81, 
            115, 88, -127, 23, 105, 58, 47, 73, 
            9, -32, -39, -77, 123, -120, -4, 112, 
            -50, 31, -119, -4, 80, -93, -63, -18, 
            -76, 71, -51, -57, 87, -9, -102, -51, 
            106, -99, 6, -87, -19, -99, 54, -101, 
            101, -123, -92, -18, -100, -42, 75, -87, 
            -4, -47, 122, -1, 58, -83, 0, -98, 
            -100, 84, -100, 34, 124, 78, -74, -87, 
            83, 118, -112, 20, 29, 118, -124, 59, 
            -64, -102, 57, 73, 67, -45, 60, -110, 
            115, -13, -46, -123, -99, 56, 43, 107, 
            -84, -97, 57, 85, -44, 43, -46, -127, 
            -82, -26, -14, -43, -103, -72, 36, -104, 
            59, -29, -88, -125, 69, -96, -55, -58, 
            -10, 2, -12, -103, -123, 116, 46, 36, 
            97, -92, 23, 21, -80, 95, 65, 70, 
            91, -13, 93, -4, 62, 101, -74, -125, 
            39, 47, -72, -117, -124, -108, -32, 25, 
            -72, -48, -114, 18, 71, 119, -127, 115, 
            109, 25, -127, -43, 124, 48, -32, -61, 
            -59, 91, -58, -116, -76, -27, -11, -37, 
            -86, -47, -35, -126, 68, 55, 4, 39, 
            33, -51, -70, -73, -39, 46, 19, 93, 
            -32, 75, 112, -109, -81, 58, 108, -97, 
            97, -71, -63, -44, 121, -97, 92, 118, 
            -93, -97, 2, -82, -80, -36, 1, 2, 
            -97, 33, -27, -44, 93, 119, 77, -31, 
            -96, -28, -77, -1, -70, 82, -104, 44, 
            -6, 27, -30, -65, 94, 98, 94, -56, 
            126, -59, -82, -84, 4, 104, 109, -60, 
            -114, 62, 34, -82, 44, -70, 31, -54, 
            -15, -93, -16, -16, 81, -63, 69, -31, 
            -106, -8, -1, -17, 46, 101, -103, 61, 
            60, 98, 114, 63, -14, -57, 18, 41, 
            47, -68, 66, 10, -44, -22, 7, 117, 
            -41, -90, 109, 4, -102, 76, 114, -112, 
            -76, 1, -43, 10, -119, 85, -23, 114, 
            -11, 117, 126, 5, 56, -48, 5, -115, 
            95, 90, -86, -33, 103, 77, 32, 92, 
            -10, 65, -50, -51, 89, -84, 80, -128, 
            44, 9, 64, 13, -68, 73, 4, 12, 
            101, -7, -51, 56, 99, 47, -110, -93, 
            -34, 56, 55, -101, 35, -86, -126, 94, 
            -16, 87, 76, 57, -16, 123, -81, -36, 
            -86, 16, 25, 108, -14, 46, -114, -60, 
            120, -105, -77, -105, -94, -108, 75, -45, 
            -119, -65, 94, 64, 8, 0, 0, 0, 
            1, 0, 5, 88, 46, 53, 48, 57, 
            0, 0, 3, 91, 48, -126, 3, 87, 
            48, -126, 2, 63, -96, 3, 2, 1, 
            2, 2, 4, 40, 61, -31, -109, 48, 
            13, 6, 9, 42, -122, 72, -122, -9, 
            13, 1, 1, 11, 5, 0, 48, 91, 
            49, 11, 48, 9, 6, 3, 85, 4, 
            6, 19, 2, 67, 65, 49, 10, 48, 
            8, 6, 3, 85, 4, 8, 19, 1, 
            78, 49, 10, 48, 8, 6, 3, 85, 
            4, 7, 19, 1, 84, 49, 10, 48, 
            8, 6, 3, 85, 4, 10, 19, 1, 
            73, 49, 10, 48, 8, 6, 3, 85, 
            4, 11, 19, 1, 73, 49, 28, 48, 
            26, 6, 3, 85, 4, 3, 19, 19, 
            110, 111, 116, 46, 118, 101, 114, 121, 
            46, 115, 101, 99, 117, 114, 101, 46, 
            99, 111, 109, 48, 32, 23, 13, 49, 
            54, 48, 56, 49, 48, 48, 51, 53, 
            53, 50, 49, 90, 24, 15, 51, 48, 
            48, 50, 48, 52, 48, 52, 48, 51, 
            53, 53, 50, 49, 90, 48, 91, 49, 
            11, 48, 9, 6, 3, 85, 4, 6, 
            19, 2, 67, 65, 49, 10, 48, 8, 
            6, 3, 85, 4, 8, 19, 1, 78, 
            49, 10, 48, 8, 6, 3, 85, 4, 
            7, 19, 1, 84, 49, 10, 48, 8, 
            6, 3, 85, 4, 10, 19, 1, 73, 
            49, 10, 48, 8, 6, 3, 85, 4, 
            11, 19, 1, 73, 49, 28, 48, 26, 
            6, 3, 85, 4, 3, 19, 19, 110, 
            111, 116, 46, 118, 101, 114, 121, 46, 
            115, 101, 99, 117, 114, 101, 46, 99, 
            111, 109, 48, -126, 1, 34, 48, 13, 
            6, 9, 42, -122, 72, -122, -9, 13, 
            1, 1, 1, 5, 0, 3, -126, 1, 
            15, 0, 48, -126, 1, 10, 2, -126, 
            1, 1, 0, -116, -55, 88, 123, 94, 
            95, 12, 45, 126, 64, -106, 105, -18, 
            26, 76, -23, -90, -51, 95, 116, -38, 
            124, -123, -111, -87, -113, 114, 32, -1, 
            4, 103, -3, 18, -79, 76, -11, -66, 
            65, -59, -20, 92, -48, 55, 62, -71, 
            94, -67, 123, 39, 107, 100, 87, -51, 
            77, 94, -51, 27, 20, -51, -87, -7, 
            -107, -103, 26, -117, 95, -3, -31, -116, 
            79, -45, 95, 45, 99, -93, -74, 123, 
            55, 9, -70, -105, -67, 113, 103, 23, 
            103, -54, 62, -12, 121, -78, 107, 39, 
            -99, 87, -114, 16, 38, 100, -66, 53, 
            45, 35, -115, 100, -121, 100, 106, 25, 
            -64, -35, 47, -3, -8, -56, 64, 70, 
            -57, 124, 103, 100, 100, -119, -113, 92, 
            -118, -54, 103, 111, 79, -91, -63, 33, 
            -12, 18, 0, -30, 93, -22, -15, -55, 
            51, -26, -124, 72, 18, 124, -87, 54, 
            -27, -32, -83, 31, -98, 87, -57, 117, 
            -125, -19, -37, 47, -126, -85, 120, 94, 
            52, -63, 80, 48, 5, 29, 52, 41, 
            96, -128, 90, 105, -70, 78, -87, -83, 
            -2, -12, 45, -62, 105, -55, -105, 18, 
            -15, 115, 120, 73, 65, 125, 37, 73, 
            -105, -40, 18, -93, 100, -7, 9, 9, 
            33, 39, -31, -14, 37, -6, -74, 121, 
            59, 68, -53, 79, 63, 101, -49, 24, 
            -126, 84, 18, -31, -31, 110, -77, -124, 
            28, 73, -46, -120, 58, -5, -105, -72, 
            -55, -116, -60, -99, 20, -69, 19, -25, 
            -28, -96, 8, 15, 22, -124, 124, -35, 
            8, -108, 97, 2, 3, 1, 0, 1, 
            -93, 33, 48, 31, 48, 29, 6, 3, 
            85, 29, 14, 4, 22, 4, 20, 65, 
            108, -123, 68, 26, 6, 19, 93, 104, 
            -110, 69, 65, -17, 118, 91, -22, 24, 
            34, -72, -100, 48, 13, 6, 9, 42, 
            -122, 72, -122, -9, 13, 1, 1, 11, 
            5, 0, 3, -126, 1, 1, 0, 60, 
            62, 53, -123, -56, 69, 108, 41, 125, 
            16, 8, -18, 108, -48, 84, 35, 9, 
            56, -16, -105, -2, 49, 66, 115, -57, 
            9, -43, 53, -103, -39, -38, -57, 100, 
            -79, -111, -74, 46, 9, -122, 41, 84, 
            79, -44, 127, -66, 33, 60, 1, 3, 
            -102, -77, -1, 46, -10, 10, -67, 3, 
            123, 49, -7, -92, -41, 104, -86, -43, 
            -33, -107, 70, 106, 126, 106, 81, 45, 
            -71, 55, -30, -103, -19, -47, 81, -116, 
            90, -14, 127, -121, -15, -30, -82, -83, 
            103, 25, -23, -6, -19, 124, 27, 77, 
            97, -90, 51, 74, -127, 7, -66, -101, 
            14, 100, -27, -49, -55, -82, 92, 23, 
            67, -87, 58, 98, 97, 64, 124, -98, 
            -47, -80, 34, -71, -128, -25, 42, -96, 
            1, -27, 117, -93, -19, 8, -42, 72, 
            -16, -47, -109, 91, -76, 94, -19, -110, 
            -34, 114, -17, -109, 46, 14, 89, -30, 
            103, -54, 124, 25, -79, -55, -97, 92, 
            4, -46, -53, -17, -69, 31, -15, -128, 
            -91, 92, -36, 111, 114, -120, -19, 75, 
            29, 8, 88, -64, -22, -110, 114, 67, 
            -66, -8, 30, 58, 2, 68, 89, -108, 
            -96, 119, 16, -51, 69, 41, -89, 29, 
            -109, -64, -12, -58, -66, -101, 50, 32, 
            21, 124, 62, 114, -17, -44, -22, 92, 
            -56, 36, 7, 15, 44, -11, -126, 64, 
            33, -71, 96, 19, -24, 48, -116, 46, 
            14, 123, -102, 68, 29, 34, 94, 85, 
            -107, -55, -85, 95, 110, -28, 92, -98, 
            34, -105, 33, 83, -6, 25, -76, -42, 
            -49, 116, 63, 86, -116, 100, -60, 17, 
            -95, -34, 107, 41, -72, 30, -7, -44, 
            35, -93, 123
    )
    val ks = KeyStore.getInstance(KeyStore.getDefaultType())
    val fis = ByteArrayInputStream(keystore)
    ks.load(fis, "simples".toCharArray())
    val kmf = KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm())
    kmf.init(ks, "simples".toCharArray())
    val sslc = SSLContext.getInstance("TLS")
    sslc.init(kmf.getKeyManagers(), null, SecureRandom())
    SSLContext.setDefault(sslc)
}
